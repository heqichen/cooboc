<html>
	<head>
		<title>Head Position Detect for Faurecia</title>
		<script src="/static/jquery-1.11.2.min.js"></script>
<script>


var lowTemp = 15.0;
var highTemp = 40.0;
var threshold = 30.0;

var map = function(x, in_min, in_max, out_min, out_max) {
	x = parseFloat(x);
	in_min = parseFloat(in_min);
	in_max = parseFloat(in_max);
	out_min = parseFloat(out_min);
	out_max = parseFloat(out_max);
	return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}

var constraint = function(x, in_min, in_max) {
	if (x < in_min) {
		x = in_min;
	}
	if (x > in_max) {
		x = in_max;
	}
	return x;
}


$(document).ready(function() {
	var firCell = [];
	var filteredCell = [];
	var x, y;
	for (y=0; y<4; ++y) {
		for (x=0; x<16; ++x)
		{
			firCell[y*16 + x] = $("<div>", {"id":"fir_cell_" + Number(y*16+x),"class":"fir_cell" })
				.offset({"top": Number(y*50), "left": Number(x*100)})
				.appendTo($("#wrapper"));
			filteredCell[y*16 + x] = $("<div>", {"id":"filtered_cell_" + Number(y*16+x),"class":"fir_cell" })
				.offset({"top": Number(y*50), "left": Number(x*100)})
				.appendTo($("#filtered_wrapper"));
		}
	}

	$("#lowTemp").on("change", function(){
		lowTemp = $("#lowTemp").val();
	});
	$("#highTemp").on("change", function(){
		highTemp = $("#highTemp").val();
	});
	$("#threshold").on("change", function() {
		threshold = $("#threshold").val();
		$("#threshold-text").text(threshold);
	});


	var onNewFirArray = function(data, textStatus, jqXHR) {
		//alert(data.firArray);
		var i;
		for (i=0; i<64; ++i) {
			firCell[i].text(data.firArray[i]);
			r = map(data.firArray[i], lowTemp, highTemp, 0.0, 255.0);
			r = constraint(r, 0, 255);
			g = 0.0;
			b = map(data.firArray[i], lowTemp, highTemp, 255.0, 0.0);
			b = constraint(b, 0, 255);

			firCell[i].css("background-color", "rgb(" + parseInt(r) + "," + parseInt(g) + "," + parseInt(b) + ")");

			if (data.firArray[i] > threshold) {
				filteredCell[i].css("background-color", "white");
			} else {
				filteredCell[i].css("background-color", "gray");
			}

		}
	};

	var updateData = function() {
		$.ajax({
			url: "/getFirArray", 
			dataType: "json", 
			method: "GET", 
			success: onNewFirArray
		});
	};

	setInterval(updateData, 200);

});
</script>
<style>
#wrapper
{
	position:	relative;
	width:	1600px;
	height:	200px;
	display:	inline-block;
}

#filtered_wrapper
{
	position:	relative;
	width:	1600px;
	height:	200px;
	display:	inline-block;
}

.fir_cell
{
	position: absolute;
	width:	100px;
	height:	50px;
	display: block;
	text-align:	center;
	font-weight: bold;
	color:	white;
}


</style>
	</head>
	<body>
		<div id="wrapper">&nbsp;</div> <br />
		<div id="control_panel">
			Low Temperature: <input type="text" value="15.0" id="lowTemp"/>, High Temperature: <input type="text" value="40.0" id="highTemp"/> <br />
			Threshold: <input type="range" id="threshold" value="30.0" min="20" max="35" step="0.1" for="threshold-text"/><span id="threshold-text">30.0</span><br />


		</div><br />
		<div id="filtered_wrapper">&nbsp;</div>
	</body>
</html>
